<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0" />
    <title>Calculatrice Anime</title>
    <link
      rel="stylesheet"
      href="style.css" />
  </head>
  <body>
    <div class="container">
      <h1>Calculatrice DreamTeam üåå</h1>
      <form id="calcForm">
        <label for="n1">Nombre 1 :</label>
        <input
          type="number"
          id="n1"
          name="n1"
          placeholder="Entrez le premier nombre"
          required />

        <label for="n2">Nombre 2 :</label>
        <input
          type="number"
          id="n2"
          name="n2"
          placeholder="Entrez le second nombre"
          required />

        <label for="op">Op√©ration :</label>
        <select
          id="op"
          name="op"
          required>
          <option value="add">Addition (+)</option>
          <option value="sub">Soustraction (-)</option>
          <option value="mul">Multiplication (*)</option>
          <option value="div">Division (/)</option>
          <option value="all">Toutes les op√©rations</option>
        </select>

        <button type="submit">Envoyer</button>
      </form>

      <div class="results-panel">
        <h2>R√©sultats r√©cents</h2>
        <button id="refreshResults">üîÑ Rafra√Æchir</button>
        <div
          id="resultsContainer"
          class="results-container">
          <p class="no-results">Aucun r√©sultat disponible</p>
        </div>
      </div>

      <button id="toggleTheme">Activer le mode sombre</button>
      <div class="footer">Farid, Mody, Verdiane & Georgi Corp üåå</div>
    </div>

    <script>
      // Gestionnaire d'√©v√©nement pour le formulaire
      document
        .getElementById("calcForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault(); // Emp√™che le rechargement de la page

          // R√©cup√®re les valeurs du formulaire
          const n1 = document.getElementById("n1").value;
          const n2 = document.getElementById("n2").value;
          const op = document.getElementById("op").value;

          // Envoie les donn√©es au backend
          try {
            const response = await fetch("http://localhost:3000/api/produce", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ n1, n2, op }),
            });

            if (response.ok) {
              const result = await response.json();
              alert(`‚úÖ Message envoy√© : ${JSON.stringify(result)}`);
            } else {
              alert("‚ùå Une erreur est survenue lors de l'envoi des donn√©es.");
            }
          } catch (error) {
            console.error("Erreur r√©seau :", error);
            alert("‚ùå Impossible de se connecter au serveur.");
          }
        });

      // Gestion des th√®mes (clair, sombre, Naruto)
      const toggleThemeButton = document.getElementById("toggleTheme");
      let currentTheme = "light"; // Th√®me par d√©faut

      toggleThemeButton.addEventListener("click", () => {
        // Rotation des th√®mes : light -> dark -> naruto -> light
        if (currentTheme === "light") {
          document.body.classList.add("dark-mode");
          document.body.classList.remove("naruto-mode");
          toggleThemeButton.textContent = "Activer le th√®me Naruto";
          currentTheme = "dark";
        } else if (currentTheme === "dark") {
          document.body.classList.remove("dark-mode");
          document.body.classList.add("naruto-mode");
          toggleThemeButton.textContent = "Activer le th√®me clair";
          currentTheme = "naruto";
        } else {
          document.body.classList.remove("naruto-mode");
          document.body.classList.remove("dark-mode");
          toggleThemeButton.textContent = "Activer le th√®me sombre";
          currentTheme = "light";
        }
      });
      // R√©cup√©rer et afficher les r√©sultats
      async function fetchResults() {
        try {
          const response = await fetch("http://localhost:3001/results");
          if (response.ok) {
            const results = await response.json();
            displayResults(results);
          } else {
            console.error("Erreur lors de la r√©cup√©ration des r√©sultats");
          }
        } catch (error) {
          console.error("Erreur r√©seau:", error);
        }
      }

      function displayResults(results) {
        const container = document.getElementById("resultsContainer");

        if (results.length === 0) {
          container.innerHTML =
            '<p class="no-results">Aucun r√©sultat disponible</p>';
          return;
        }

        let html = "";
        results.forEach((result) => {
          let operationSymbol = "";
          switch (result.op) {
            case "add":
              operationSymbol = "+";
              break;
            case "sub":
              operationSymbol = "-";
              break;
            case "mul":
              operationSymbol = "√ó";
              break;
            case "div":
              operationSymbol = "√∑";
              break;
            default:
              operationSymbol = result.op;
          }

          let resultValue = result.result;
          if (resultValue === undefined && result.error) {
            resultValue = `Erreur: ${result.error}`;
          }

          html += `
        <div class="result-item">
          <div class="result-operation">${result.n1} ${operationSymbol} ${result.n2}</div>
          <div class="result-value">= ${resultValue}</div>
          <div class="result-time">${result.timestamp}</div>
        </div>
      `;
        });

        container.innerHTML = html;
      }

      // Ajouter un √©couteur pour le bouton de rafra√Æchissement
      document
        .getElementById("refreshResults")
        .addEventListener("click", fetchResults);

      // Charger les r√©sultats au d√©marrage
      fetchResults();

      // Rafra√Æchir automatiquement toutes les 5 secondes
      setInterval(fetchResults, 5000);
    </script>
  </body>
</html>
